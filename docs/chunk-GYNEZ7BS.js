import{a as be}from"./chunk-XPFFTSXC.js";import{a as Ce}from"./chunk-LQP35CM2.js";import{a as ve}from"./chunk-JBP6HANX.js";import{a as he}from"./chunk-Y5RI4PHI.js";import{$ as Te,Z as Q,h as b,j as ge}from"./chunk-4RIDPFY2.js";import{a as ye}from"./chunk-OD2F5SLA.js";import{a as me,b as ue,c as ce}from"./chunk-6HRBECBJ.js";import{a as de}from"./chunk-Z76PEBTC.js";import{c as B,d as z}from"./chunk-SIF5SKDU.js";import{a as ie}from"./chunk-QZ2WTBPW.js";import{a as fe}from"./chunk-HIKYOSQ5.js";import{e as ae}from"./chunk-YP5VDLTG.js";import{n as F}from"./chunk-7TJE7DO7.js";import{a as $}from"./chunk-WTDAEWCX.js";import{c as le}from"./chunk-6WEMRU4N.js";import{a as O,d as re,h as se}from"./chunk-BV6IOHNV.js";import{B as k,D as V,c as oe,e as d,h as w,i as R,o as q,r as M,t as P,w as ne}from"./chunk-4JDFQORI.js";import{a as pe}from"./chunk-TWDZ6JFE.js";import{a as E,b as G}from"./chunk-ETZ3F2L4.js";import{$b as u,Ab as D,Gb as c,Ic as y,Jc as h,Ob as o,Vb as A,Wb as j,Xb as v,Yb as g,Zb as s,_b as a,gc as S,hd as Z,id as ee,jd as te,mc as J,md as x,nc as K,oc as X,pb as i,rc as L,sc as l,tb as m,tc as T,uc as _,v as W,vc as N}from"./chunk-3Q5CJMKA.js";import{b as I}from"./chunk-WFMAM73Y.js";import{a as C,b as U}from"./chunk-2AVGQ2MQ.js";function xe(n,e){if(n&1&&(s(0,"mat-option",18),l(1),a()),n&2){let t=e.$implicit;o("value",t),i(),T(t)}}function Ee(n,e){if(n&1&&(s(0,"mat-option",18),l(1),a()),n&2){let t=e.$implicit;o("value",t.subType),i(),N(" ",t.subType," \u2013 ",t.subTypeDescription," ")}}function Fe(n,e){if(n&1&&(s(0,"mat-option",12),l(1),a()),n&2){let t=e.$implicit;o("value",t.networkName),i(),T(t.networkName)}}function we(n,e){if(n&1&&(s(0,"mat-option",12),l(1),a()),n&2){let t=e.$implicit;o("value",t.networkName),i(),T(t.networkName)}}function Re(n,e){if(n&1&&(s(0,"mat-option",18),l(1),a()),n&2){let t=e.$implicit;o("value",t),i(),T(t)}}function qe(n,e){if(n&1&&(s(0,"div",4)(1,"mat-form-field",5)(2,"mat-label"),l(3,"Resolution Date"),a(),u(4,"input",6)(5,"mat-datepicker-toggle",7)(6,"mat-datepicker",null,1),a()()),n&2){let t=L(7);i(),o("subscriptSizing","dynamic"),i(3),o("matDatepicker",t)("formControlName","resolutionDate"),i(),o("for",t)}}function Me(n,e){n&1&&(s(0,"div",4)(1,"mat-form-field",5)(2,"mat-label"),l(3,"Created By"),a(),u(4,"input",19),a()()),n&2&&(i(),o("subscriptSizing","dynamic"),i(3),o("formControlName","createdBy"))}function Pe(n,e){n&1&&(s(0,"div",4)(1,"mat-form-field",5)(2,"mat-label"),l(3,"Contact Note"),a(),u(4,"textarea",20),a()()),n&2&&(i(),o("subscriptSizing","dynamic"),i(3),o("formControlName","contactNote"))}function ke(n,e){if(n&1&&(s(0,"fuse-alert",21),l(1),a()),n&2){let t=S();o("appearance","outline")("type",t.alert.type)("showIcon",!1)("@shake",!0),i(),_(" ",t.alert.message," ")}}var Ie=class H{constructor(e,t,r,p,f){this.data=e,this.dialogRef=t,this.formBuilder=r,this.store=p,this.auxUtilService=f,this.auditTypes=["SERVICE","ADMIN"],this.issueSubtypes={SERVICE:[{subType:"SERVICE1 ",subTypeDescription:"No print, No ship"},{subType:"SERVICE2",subTypeDescription:"Product"},{subType:"SERVICE3 ",subTypeDescription:"Communication"}],ADMIN:[{subType:"ADMIN1",subTypeDescription:"Medical Records"},{subType:"ADMIN2",subTypeDescription:"Documentation Error"},{subType:"ADMIN3",subTypeDescription:"Eligibility"},{subType:"ADMIN4",subTypeDescription:"Wound Assessment"},{subType:"ADMIN5",subTypeDescription:"Improper Shipment"},{subType:"ADMIN8",subTypeDescription:"Signature Hold"},{subType:"ADMIN9",subTypeDescription:"Dressing Size"}]},this.resolutions=["RESOLVED","NOT RESOLVED"],this.alert=null,this.owners$=this.store.select(Q.selectOwners),this.loadingOwners$=this.store.select(Q.selectOwnersLoading),this.audit=e.dynamicComponentData?.audit,this.patientId=e.dynamicComponentData?.patientId,this.store.dispatch(ge.LoadOwners())}ngOnInit(){this.auditForm=this.formBuilder.group({dateOfAudit:["",d.required],subType:["",d.required],auditType:["",d.required],assignedTo:["",d.required],auditor:["",d.required],createdBy:[{value:this.data?.dynamicComponentData?.addedBy,disabled:!0}],resolution:[""],resolutionDate:[""],contactNote:["",d.required],patientId:[this.patientId]}),this.audit&&(this.auditForm.patchValue(U(C({},this.audit),{subType:this.audit.subType,resolutionDate:this.audit.resolutionDate=="1900-01-01T00:00:00"?"":this.audit.resolutionDate})),this.auditForm.get("contactNote")?.clearValidators()),this.auditForm.get("auditType")?.valueChanges.pipe(G(this)).subscribe(e=>{this.auditForm.get("subType")?.setValue(""),this.auditForm.get("subType")?.updateValueAndValidity()}),this.auditForm.get("resolution")?.valueChanges.pipe(W(e=>{let t=this.auditForm.get("resolutionDate");e==="RESOLVED"?t?.setValidators(d.required):(t?.clearValidators(),t?.setValue("")),t?.updateValueAndValidity()}),G(this)).subscribe()}ngAfterViewInit(){}ngOnDestroy(){}getSubtypes(){let e=this.auditForm.get("auditType")?.value;return e?this.issueSubtypes[e]||[]:[]}saveAudit(){if(this.auditForm.invalid){console.log("this.auditForm",this.auditForm),this.alert={type:"error",message:"Please fill all required fields."},setTimeout(()=>this.alert=null,6e3);return}let e=C({},this.auditForm.getRawValue()),t=e.subType,r=this.getSubtypes().find(f=>f.subType===t);e.subType=r?r.subType:"",e.subTypeDescription=r?r.subTypeDescription:"",(!e.resolutionDate||e.resolution!=="RESOLVED")&&(e.resolutionDate="1900-01-01"),e=this.auxUtilService.transFormValuesToUpperCase(e,["auditType","subType","subTypeDescription","assignedTo","auditor","createdBy","resolution","contactNote"]),e=U(C({},e),{patientId:this.patientId,id:this.audit?.id||0});let p=this.audit?.id?b.updateAudit:b.addAudit;this.store.dispatch(p({audit:e})),this.dialogRef.close({success:!0})}closeDialog(){this.dialogRef.close()}static{this.\u0275fac=function(t){return new(t||H)(m(z),m(B),m(k),m(F),m(de))}}static{this.\u0275cmp=D({type:H,selectors:[["app-patient-audit-add-request"]],decls:51,vars:32,consts:[["picker",""],["resolutionPicker",""],[1,"relative","flex","flex-auto","flex-col","items-center","px-6","sm:px-9"],[1,"w-full","max-w-3xl",3,"formGroup"],[1,"mt-4"],[1,"w-full",3,"subscriptSizing"],["matInput","","required","",3,"matDatepicker","formControlName"],["matSuffix","",3,"for"],["required","",3,"formControlName"],[3,"value",4,"ngFor","ngForOf"],[1,"w-6/12","pr-2",3,"subscriptSizing"],["formControlName","assignedTo"],[1,"uppercase",3,"value"],["type","spinner",3,"diameter","show"],[1,"w-6/12",3,"subscriptSizing"],["formControlName","auditor"],["class","mt-4",4,"ngIf"],["class","mt-4",3,"appearance","type","showIcon",4,"ngIf"],[3,"value"],["matInput","","readonly","",3,"formControlName"],["matInput","","rows","4",1,"uppercase",3,"formControlName"],[1,"mt-4",3,"appearance","type","showIcon"]],template:function(t,r){if(t&1&&(s(0,"div",2)(1,"form",3)(2,"div",4)(3,"mat-form-field",5)(4,"mat-label"),l(5,"Date of Audit"),a(),u(6,"input",6)(7,"mat-datepicker-toggle",7)(8,"mat-datepicker",null,0),a()(),s(10,"div",4)(11,"mat-form-field",5)(12,"mat-label"),l(13,"Audit Type"),a(),s(14,"mat-select",8),c(15,xe,2,2,"mat-option",9),a()()(),s(16,"div",4)(17,"mat-form-field",5)(18,"mat-label"),l(19,"Subtype"),a(),s(20,"mat-select",8),c(21,Ee,2,3,"mat-option",9),a()()(),s(22,"div",4)(23,"mat-form-field",10)(24,"mat-label"),l(25,"Assigned To"),a(),s(26,"mat-select",11),v(27,Fe,2,2,"mat-option",12,j),y(29,"async"),a()(),u(30,"ac-loading-overlay",13),y(31,"async"),s(32,"mat-form-field",14)(33,"mat-label"),l(34,"Auditor"),a(),s(35,"mat-select",15),v(36,we,2,2,"mat-option",12,j),y(38,"async"),a()(),u(39,"ac-loading-overlay",13),y(40,"async"),a(),s(41,"div",4)(42,"mat-form-field",5)(43,"mat-label"),l(44,"Resolution"),a(),s(45,"mat-select",8),c(46,Re,2,2,"mat-option",9),a()()(),c(47,qe,8,4,"div",16)(48,Me,5,2,"div",16)(49,Pe,5,2,"div",16)(50,ke,2,5,"fuse-alert",17),a()()),t&2){let p,f=L(9);i(),o("formGroup",r.auditForm),i(2),o("subscriptSizing","dynamic"),i(3),o("matDatepicker",f)("formControlName","dateOfAudit"),i(),o("for",f),i(4),o("subscriptSizing","dynamic"),i(3),o("formControlName","auditType"),i(),o("ngForOf",r.auditTypes),i(2),o("subscriptSizing","dynamic"),i(3),o("formControlName","subType"),i(),o("ngForOf",r.getSubtypes()),i(2),o("subscriptSizing","dynamic"),i(4),g(h(29,24,r.owners$)),i(3),o("diameter",50)("show",h(31,26,r.loadingOwners$)),i(2),o("subscriptSizing","dynamic"),i(4),g(h(38,28,r.owners$)),i(3),o("diameter",50)("show",h(40,30,r.loadingOwners$)),i(3),o("subscriptSizing","dynamic"),i(3),o("formControlName","resolution"),i(),o("ngForOf",r.resolutions),i(),o("ngIf",((p=r.auditForm.get("resolution"))==null?null:p.value)==="RESOLVED"),i(),o("ngIf",r.audit),i(),o("ngIf",!r.audit),i(),o("ngIf",r.alert)}},dependencies:[V,q,oe,w,R,ne,M,P,se,O,le,ue,ce,re,me,fe,ee,ae,te,$,x,ie],styles:[`:host{display:flex;flex-direction:column;height:100%}.custom-container{background-color:#fff;border-left:1px solid #e0e0e0;box-shadow:-2px 0 8px #0000001a}@keyframes shake{0%{transform:translate(0)}25%{transform:translate(-5px)}50%{transform:translate(5px)}75%{transform:translate(-5px)}to{transform:translate(0)}}
`],encapsulation:2,data:{animation:pe}})}};Ie=I([E()],Ie);var Ve=["quillEditor"],Oe=(n,e)=>e.id;function Be(n,e){if(n&1&&(s(0,"div",11)(1,"span",12),l(2),y(3,"datetimeformat"),a(),u(4,"app-aux-html-content-renderer",13),a(),u(5,"mat-divider",14)),n&2){let t=e.$implicit;o("ngClass",t.priority==="PRIORITY"?"text-red-500":"text-black dark:text-white"),i(2),N(" ADDED ON ",h(3,4,t.addDate)," BY ",t.addUserId," "),i(2),o("htmlContent",t.note.toUpperCase())}}function ze(n,e){n&1&&(s(0,"div",10),l(1,"No notes found"),a())}function $e(n,e){if(n&1&&(v(0,Be,6,6,null,null,Oe),c(2,ze,2,0,"div",10)),n&2){let t=e;g(t),i(2),A(t.length?-1:2)}}function Ue(n,e){if(n&1&&(s(0,"fuse-alert",9),l(1),a()),n&2){let t=S();o("appearance","outline")("type",t.alert.type)("showIcon",!1)("@shake",!0),i(),_(" ",t.alert.message," ")}}var De=class Y{constructor(e,t,r,p){this.formBuilder=e,this.store=t,this.dialogRef=r,this.data=p,this.alert=null,this.quillModules={toolbar:!1},this.contactNotes$=this.store.select(Te.selectContactNotes)}ngOnInit(){this.initForm()}initForm(){let e=this.data||{},t=e.patientId||0,r=e.refId||0,p=e.moduleName||"AUDIT",f="AUDIT";this.auditForm=this.formBuilder.group({contactType:[f,d.required],note:["",d.required],priority:[!1],entityID:[t,d.required],refId:[r],moduleName:[p]})}saveContactNote(){if(!this.auditForm){console.error("Form is not initialized"),this.alert={type:"error",message:"Form initialization failed. Please try again."},setTimeout(()=>{this.alert=null},6e3);return}let e=this.auditForm.value,r=this.quillEditor.quillEditor.getText().trim(),p={id:0,entityType:"PATIENT",entityID:e.entityID,contactType:e.contactType,note:r.toUpperCase(),addUserId:"SYSTEM",addDate:new Date().toISOString(),message:"",priority:e.priority?"PRIORITY":"",refId:e.refId};this.isInputValid(p)&&(this.store.dispatch(b.AddContactNote({note:p})),this.dialogRef.close())}isInputValid(e){return e.contactType?!e.note||e.note.trim()===""||e.note==="<p><br></p>"||e.note==="<H1><BR></H1>"?(this.alert={type:"error",message:"Note cannot be blank."},setTimeout(()=>{this.alert=null},6e3),!1):e.entityID?!0:(this.alert={type:"error",message:"entity ID cannot be blank."},setTimeout(()=>{this.alert=null},6e3),!1):(this.alert={type:"error",message:"Contact Type cannot be blank."},setTimeout(()=>{this.alert=null},6e3),!1)}closeDialog(){this.dialogRef.close()}static{this.\u0275fac=function(t){return new(t||Y)(m(k),m(F),m(B),m(z))}}static{this.\u0275cmp=D({type:Y,selectors:[["app-patient-audit-notes"]],viewQuery:function(t,r){if(t&1&&J(Ve,5),t&2){let p;K(p=X())&&(r.quillEditor=p.first)}},decls:14,vars:8,consts:[["quillEditor",""],[1,"flex","h-full","flex-col"],[1,"flex-1","overflow-y-auto"],[1,"h-full"],[3,"formGroup"],[1,"mt-8","bg-white","p-4","shadow-inner","dark:bg-gray-900"],[1,"text-black","dark:text-white"],[1,"text-red"],[1,"mt-2","w-full","uppercase",3,"formControlName","placeholder","modules"],[1,"mt-4",3,"appearance","type","showIcon"],[1,"p-4","text-center","text-gray-500"],[1,"flex","flex-col","p-4",3,"ngClass"],[1,"text-secondary","text-sm"],[3,"htmlContent"],[1,"w-full"]],template:function(t,r){if(t&1&&(s(0,"div",1)(1,"div",2)(2,"ac-scrollbar",3),c(3,$e,3,1),y(4,"async"),a()(),s(5,"form",4)(6,"div",5)(7,"mat-label",6),l(8,"Notes"),a(),s(9,"mat-label",7),l(10,"*"),a(),u(11,"quill-editor",8,0),a(),c(13,Ue,2,5,"fuse-alert",9),a()()),t&2){let p;i(3),A((p=h(4,6,r.contactNotes$))?3:-1,p),i(2),o("formGroup",r.auditForm),i(6),o("formControlName","note")("placeholder","Notes")("modules",r.quillModules),i(2),A(r.alert?13:-1)}},dependencies:[Ce,Z,be,ye,V,q,w,R,M,P,O,ve,$,x,he],encapsulation:2})}};De=I([E()],De);export{Ie as a,De as b};
