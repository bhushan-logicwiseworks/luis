import{a as Ce}from"./chunk-XPFFTSXC.js";import{a as he}from"./chunk-LQP35CM2.js";import{a as fe}from"./chunk-JBP6HANX.js";import{a as ue}from"./chunk-Y5RI4PHI.js";import{Y as ye,e as y}from"./chunk-4RIDPFY2.js";import{a as de}from"./chunk-OD2F5SLA.js";import{a as pe,b as se,c as me}from"./chunk-6HRBECBJ.js";import{a as le}from"./chunk-Z76PEBTC.js";import{c as P,d as q}from"./chunk-SIF5SKDU.js";import{a as ce}from"./chunk-HIKYOSQ5.js";import{e as ie}from"./chunk-YP5VDLTG.js";import{n as N}from"./chunk-7TJE7DO7.js";import{a as M}from"./chunk-WTDAEWCX.js";import{c as ae}from"./chunk-6WEMRU4N.js";import{a as O,d as oe,h as ne}from"./chunk-BV6IOHNV.js";import{B as A,D as F,c as ee,e as c,h as E,i as S,o as x,r as _,t as R,w as te}from"./chunk-4JDFQORI.js";import{a as re}from"./chunk-TWDZ6JFE.js";import{a as D,b as B}from"./chunk-ETZ3F2L4.js";import{$b as u,Ab as T,Gb as d,Ic as w,Jc as L,Ob as o,Vb as v,Xb as z,Yb as $,Zb as l,_b as a,gc as I,hd as J,id as K,jd as W,mc as Q,md as X,nc as Y,oc as Z,pb as i,rc as k,sc as s,tb as m,tc as U,uc as b,v as H,vc as g}from"./chunk-3Q5CJMKA.js";import{b as h}from"./chunk-WFMAM73Y.js";import{a as C,b as V}from"./chunk-2AVGQ2MQ.js";function Ne(n,e){if(n&1&&(l(0,"mat-option",12),s(1),a()),n&2){let t=e.$implicit;o("value",t),i(),U(t)}}function Ee(n,e){if(n&1&&(l(0,"mat-option",12),s(1),a()),n&2){let t=e.$implicit;o("value",t.subType),i(),g(" ",t.subType," \u2013 ",t.subTypeDescription," ")}}function Se(n,e){if(n&1&&(l(0,"mat-option",12),s(1),a()),n&2){let t=e.$implicit;o("value",t),i(),U(t)}}function xe(n,e){if(n&1&&(l(0,"div",4)(1,"mat-form-field",5)(2,"mat-label"),s(3,"Resolution Date"),a(),u(4,"input",6)(5,"mat-datepicker-toggle",7)(6,"mat-datepicker",null,1),a()()),n&2){let t=k(7);i(),o("subscriptSizing","dynamic"),i(3),o("matDatepicker",t)("formControlName","resolutionDate"),i(),o("for",t)}}function _e(n,e){n&1&&(l(0,"div",4)(1,"mat-form-field",5)(2,"mat-label"),s(3,"Created By"),a(),u(4,"input",13),a()()),n&2&&(i(),o("subscriptSizing","dynamic"),i(3),o("formControlName","createdBy"))}function Re(n,e){n&1&&(l(0,"div",4)(1,"mat-form-field",5)(2,"mat-label"),s(3,"Contact Note"),a(),u(4,"textarea",14),a()()),n&2&&(i(),o("subscriptSizing","dynamic"),i(3),o("formControlName","contactNote"))}function Ae(n,e){if(n&1&&(l(0,"fuse-alert",15),s(1),a()),n&2){let t=I();o("appearance","outline")("type",t.alert.type)("showIcon",!1)("@shake",!0),i(),b(" ",t.alert.message," ")}}var Te=class j{constructor(e,t,r,p,f){this.data=e,this.dialogRef=t,this.formBuilder=r,this.store=p,this.auxUtilService=f,this.issueTypes=["CONCERN","COMPLAINT","HIPAA"],this.issueSubtypes={CONCERN:[{subType:"CON1",subTypeDescription:"PRODUCT ISSUE"},{subType:"CON2",subTypeDescription:"PRODUCT PERFORMANCE ISSUE"},{subType:"CON3",subTypeDescription:"POOR CUSTOMER SERVICE"},{subType:"CON4",subTypeDescription:"BILLING-RETURN ISSUE"},{subType:"CON5",subTypeDescription:"NO-FAULT ISSUE"},{subType:"CON6",subTypeDescription:"OTHER ISSUES"}],COMPLAINT:[{subType:"CMP1",subTypeDescription:"ADVERSE EFFECT"},{subType:"CMP2",subTypeDescription:"UNETHICAL BEHAVIOR"},{subType:"CMP3",subTypeDescription:"UNRESOLVED"}],HIPAA:[{subType:"HIPAA1",subTypeDescription:"AUTHORIZED DISCLOSURE"},{subType:"HIPAA2",subTypeDescription:"SECURITY INCIDENT"}]},this.resolutions=["RESOLVED","NOT RESOLVED"],this.alert=null,this.compliance=e.dynamicComponentData?.compliance,this.patientId=e.dynamicComponentData?.patientId}ngOnInit(){this.complianceForm=this.formBuilder.group({dateOfOccurrence:["",c.required],issueType:["",c.required],subType:["",c.required],createdBy:[{value:this.data?.dynamicComponentData?.addedBy,disabled:!0}],resolution:[""],resolutionDate:[""],contactNote:["",c.required],patientId:[this.patientId]}),this.compliance&&(this.complianceForm.patchValue(V(C({},this.compliance),{subType:this.compliance.subType,resolutionDate:this.compliance.resolutionDate=="1900-01-01T00:00:00"?"":this.compliance.resolutionDate})),this.complianceForm.get("contactNote")?.clearValidators()),this.complianceForm.get("issueType")?.valueChanges.pipe(B(this)).subscribe(e=>{this.complianceForm.get("subType")?.setValue(""),this.complianceForm.get("subType")?.updateValueAndValidity()}),this.complianceForm.get("resolution")?.valueChanges.pipe(H(e=>{let t=this.complianceForm.get("resolutionDate");e==="RESOLVED"?t?.setValidators(c.required):(t?.clearValidators(),t?.setValue("")),t?.updateValueAndValidity()}),B(this)).subscribe()}ngAfterViewInit(){}ngOnDestroy(){}getSubtypes(){let e=this.complianceForm.get("issueType")?.value;return e?this.issueSubtypes[e]||[]:[]}saveCompliance(){if(this.complianceForm.invalid){console.log("this.complianceForm",this.complianceForm),this.alert={type:"error",message:"Please fill all required fields."},setTimeout(()=>this.alert=null,6e3);return}let e=C({},this.complianceForm.getRawValue()),t=e.subType,r=this.getSubtypes().find(f=>f.subType===t);e.subType=r?r.subType:"",e.subTypeDescription=r?r.subTypeDescription:"",(!e.resolutionDate||e.resolution!=="RESOLVED")&&(e.resolutionDate="1900-01-01"),e=this.auxUtilService.transFormValuesToUpperCase(e,["issueType","subType","resolution","createdBy","contactNote","subTypeDescription"]),e=V(C({},e),{patientId:this.patientId,id:this.compliance?.id||0});let p=this.compliance?.id?y.updateCompliance:y.addCompliance;this.store.dispatch(p({compliance:e})),this.dialogRef.close({success:!0})}closeDialog(){this.dialogRef.close()}static{this.\u0275fac=function(t){return new(t||j)(m(q),m(P),m(A),m(N),m(le))}}static{this.\u0275cmp=T({type:j,selectors:[["app-patient-compliance-add-request"]],decls:32,vars:18,consts:[["picker",""],["resolutionPicker",""],[1,"relative","flex","flex-auto","flex-col","items-center","px-6","sm:px-9"],[1,"w-full","max-w-3xl",3,"formGroup"],[1,"mt-4"],[1,"w-full",3,"subscriptSizing"],["matInput","","required","",3,"matDatepicker","formControlName"],["matSuffix","",3,"for"],["required","",3,"formControlName"],[3,"value",4,"ngFor","ngForOf"],["class","mt-4",4,"ngIf"],["class","mt-4",3,"appearance","type","showIcon",4,"ngIf"],[3,"value"],["matInput","","readonly","",3,"formControlName"],["matInput","","rows","4",1,"uppercase",3,"formControlName"],[1,"mt-4",3,"appearance","type","showIcon"]],template:function(t,r){if(t&1&&(l(0,"div",2)(1,"form",3)(2,"div",4)(3,"mat-form-field",5)(4,"mat-label"),s(5,"Date of Occurrence"),a(),u(6,"input",6)(7,"mat-datepicker-toggle",7)(8,"mat-datepicker",null,0),a()(),l(10,"div",4)(11,"mat-form-field",5)(12,"mat-label"),s(13,"Issue Type"),a(),l(14,"mat-select",8),d(15,Ne,2,2,"mat-option",9),a()()(),l(16,"div",4)(17,"mat-form-field",5)(18,"mat-label"),s(19,"Subtype"),a(),l(20,"mat-select",8),d(21,Ee,2,3,"mat-option",9),a()()(),l(22,"div",4)(23,"mat-form-field",5)(24,"mat-label"),s(25,"Resolution"),a(),l(26,"mat-select",8),d(27,Se,2,2,"mat-option",9),a()()(),d(28,xe,8,4,"div",10)(29,_e,5,2,"div",10)(30,Re,5,2,"div",10)(31,Ae,2,5,"fuse-alert",11),a()()),t&2){let p,f=k(9);i(),o("formGroup",r.complianceForm),i(2),o("subscriptSizing","dynamic"),i(3),o("matDatepicker",f)("formControlName","dateOfOccurrence"),i(),o("for",f),i(4),o("subscriptSizing","dynamic"),i(3),o("formControlName","issueType"),i(),o("ngForOf",r.issueTypes),i(2),o("subscriptSizing","dynamic"),i(3),o("formControlName","subType"),i(),o("ngForOf",r.getSubtypes()),i(2),o("subscriptSizing","dynamic"),i(3),o("formControlName","resolution"),i(),o("ngForOf",r.resolutions),i(),o("ngIf",((p=r.complianceForm.get("resolution"))==null?null:p.value)==="RESOLVED"),i(),o("ngIf",r.compliance),i(),o("ngIf",!r.compliance),i(),o("ngIf",r.alert)}},dependencies:[F,x,ee,E,S,te,_,R,ne,O,ae,se,me,oe,pe,ce,K,ie,W,M],styles:[`:host{display:flex;flex-direction:column;height:100%}.custom-container{background-color:#fff;border-left:1px solid #e0e0e0;box-shadow:-2px 0 8px #0000001a}@keyframes shake{0%{transform:translate(0)}25%{transform:translate(-5px)}50%{transform:translate(5px)}75%{transform:translate(-5px)}to{transform:translate(0)}}
`],encapsulation:2,data:{animation:re}})}};Te=h([D()],Te);var Fe=["quillEditor"],Oe=(n,e)=>e.id;function Pe(n,e){if(n&1&&(l(0,"div",11)(1,"span",12),s(2),w(3,"datetimeformat"),a(),u(4,"app-aux-html-content-renderer",13),a(),u(5,"mat-divider",14)),n&2){let t=e.$implicit;o("ngClass",t.priority==="PRIORITY"?"text-red-500":"text-black dark:text-white"),i(2),g(" ADDED ON ",L(3,4,t.addDate)," BY ",t.addUserId," "),i(2),o("htmlContent",t.note.toUpperCase())}}function qe(n,e){n&1&&(l(0,"div",10),s(1,"No notes found"),a())}function Me(n,e){if(n&1&&(z(0,Pe,6,6,null,null,Oe),d(2,qe,2,0,"div",10)),n&2){let t=e;$(t),i(2),v(t.length?-1:2)}}function Ve(n,e){if(n&1&&(l(0,"fuse-alert",9),s(1),a()),n&2){let t=I();o("appearance","outline")("type",t.alert.type)("showIcon",!1)("@shake",!0),i(),b(" ",t.alert.message," ")}}var ve=class G{constructor(e,t,r,p){this.formBuilder=e,this.store=t,this.dialogRef=r,this.data=p,this.alert=null,this.quillModules={toolbar:!1},this.contactNotes$=this.store.select(ye.selectContactNotes)}ngOnInit(){this.initForm()}initForm(){let e=this.data||{},t=e.patientId||0,r=e.refId||0,p=e.moduleName||"COMPLIANCE",f="COMPLIANCE";this.contactForm=this.formBuilder.group({contactType:[f,c.required],note:["",c.required],priority:[!1],entityID:[t,c.required],refId:[r],moduleName:[p]})}saveContactNote(){if(!this.contactForm){console.error("Form is not initialized"),this.alert={type:"error",message:"Form initialization failed. Please try again."},setTimeout(()=>{this.alert=null},6e3);return}let e=this.contactForm.value,r=this.quillEditor.quillEditor.getText().trim(),p={id:0,entityType:"PATIENT",entityID:e.entityID,contactType:e.contactType,note:r.toUpperCase(),addUserId:"SYSTEM",addDate:new Date().toISOString(),message:"",priority:e.priority?"PRIORITY":"",refId:e.refId};this.isInputValid(p)&&(this.store.dispatch(y.AddContactNote({note:p})),this.dialogRef.close())}isInputValid(e){return e.contactType?!e.note||e.note.trim()===""||e.note==="<p><br></p>"||e.note==="<H1><BR></H1>"?(this.alert={type:"error",message:"Note cannot be blank."},setTimeout(()=>{this.alert=null},6e3),!1):e.entityID?!0:(this.alert={type:"error",message:"entity ID cannot be blank."},setTimeout(()=>{this.alert=null},6e3),!1):(this.alert={type:"error",message:"Contact Type cannot be blank."},setTimeout(()=>{this.alert=null},6e3),!1)}closeDialog(){this.dialogRef.close()}static{this.\u0275fac=function(t){return new(t||G)(m(A),m(N),m(P),m(q))}}static{this.\u0275cmp=T({type:G,selectors:[["app-patient-compliance-notes"]],viewQuery:function(t,r){if(t&1&&Q(Fe,5),t&2){let p;Y(p=Z())&&(r.quillEditor=p.first)}},decls:14,vars:8,consts:[["quillEditor",""],[1,"flex","h-full","flex-col"],[1,"flex-1","overflow-y-auto"],[1,"h-full"],[3,"formGroup"],[1,"mt-8","bg-white","p-4","shadow-inner","dark:bg-gray-900"],[1,"text-black","dark:text-white"],[1,"text-red"],[1,"mt-2","w-full","uppercase",3,"formControlName","placeholder","modules"],[1,"mt-4",3,"appearance","type","showIcon"],[1,"p-4","text-center","text-gray-500"],[1,"flex","flex-col","p-4",3,"ngClass"],[1,"text-secondary","text-sm"],[3,"htmlContent"],[1,"w-full"]],template:function(t,r){if(t&1&&(l(0,"div",1)(1,"div",2)(2,"ac-scrollbar",3),d(3,Me,3,1),w(4,"async"),a()(),l(5,"form",4)(6,"div",5)(7,"mat-label",6),s(8,"Notes"),a(),l(9,"mat-label",7),s(10,"*"),a(),u(11,"quill-editor",8,0),a(),d(13,Ve,2,5,"fuse-alert",9),a()()),t&2){let p;i(3),v((p=L(4,6,r.contactNotes$))?3:-1,p),i(2),o("formGroup",r.contactForm),i(6),o("formControlName","note")("placeholder","Notes")("modules",r.quillModules),i(2),v(r.alert?13:-1)}},dependencies:[he,J,Ce,de,F,x,E,S,_,R,O,fe,M,X,ue],encapsulation:2})}};ve=h([D()],ve);export{Te as a,ve as b};
