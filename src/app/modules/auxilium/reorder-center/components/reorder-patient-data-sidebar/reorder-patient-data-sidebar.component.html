<div class="flex h-full flex-col bg-white pb-4 shadow dark:bg-gray-800">
    <div class="bg-blue-500 p-4 dark:bg-gray-700">
        <div class="flex items-center text-lg font-normal text-white">
            <mat-icon class="mr-4 text-white">person</mat-icon>
            Patient Details
        </div>
    </div>

    <div class="mt-4 flex flex-col px-4" *ngrxLet="patient$; let patient">
        @if (patient) {
            <div class="flex flex-col">
                <div class="flex flex-col">
                    <span class="font-bold">{{ patient.firstName }} {{ patient.lastName }} ({{ patient.sex }})</span>
                    <span>{{ patient.address }}</span>
                    @if (patient.address2) {
                        <span>{{ patient.address2 }}</span>
                    }
                    <span>{{ patient.city }} {{ patient.state }} {{ patient.zip }}</span>
                </div>
                <div class="flex flex-col">
                    @if (patient.phone) {
                        <!-- Patient Phone -->
                        <a
                            href="tel:{{ patient.phone }}"
                            class="relative flex items-center rounded-full px-2 py-3 transition duration-200 ease-in-out hover:bg-blue-100 dark:hover:bg-gray-700"
                            matRipple
                        >
                            <div
                                class="mr-3 flex h-12 w-12 items-center justify-center rounded-full bg-blue-100 text-blue-500"
                            >
                                <ic-icon [icon]="icPhone" size="24px"></ic-icon>
                            </div>
                            <div>
                                <p class="m-0 font-bold">{{ patient.phone | phonenumber }}</p>
                                <p class="text-secondary m-0">Phone</p>
                            </div>
                        </a>
                    }
                    @if (patient.cellPhone) {
                        <!-- Patient Cell Phone -->
                        <a
                            href="tel:{{ patient.cellPhone }}"
                            class="relative flex items-center rounded-full px-2 py-3 transition duration-200 ease-in-out hover:bg-blue-100 dark:hover:bg-gray-700"
                            matRipple
                        >
                            <div
                                class="mr-3 flex h-12 w-12 items-center justify-center rounded-full bg-blue-100 text-blue-500"
                            >
                                <ic-icon [icon]="icPhone" size="24px"></ic-icon>
                            </div>
                            <div>
                                <p class="m-0 font-bold">{{ patient.cellPhone | phonenumber }}</p>
                                <p class="text-secondary m-0">Cell Phone</p>
                            </div>
                        </a>
                    }
                    @if (patient.workPhone) {
                        <!-- Patient Work Phone -->
                        <a
                            href="tel:{{ patient.workPhone }}"
                            class="relative flex items-center rounded-full px-2 py-3 transition duration-200 ease-in-out hover:bg-blue-100 dark:hover:bg-gray-700"
                            matRipple
                        >
                            <div
                                class="mr-3 flex h-12 w-12 items-center justify-center rounded-full bg-blue-100 text-blue-500"
                            >
                                <ic-icon [icon]="icPhone" size="24px"></ic-icon>
                            </div>
                            <div>
                                <p class="m-0 font-bold">{{ patient.workPhone | phonenumber }}</p>
                                <p class="text-secondary m-0">Work Phone</p>
                            </div>
                        </a>
                    }
                    @if (patient.email) {
                        <!-- Patient Email -->
                        <a
                            class="relative flex items-center rounded-full px-2 py-3 transition duration-200 ease-in-out hover:bg-green-100 dark:hover:bg-gray-700"
                            matRipple
                            href="mailto:{{ patient.email }}"
                        >
                            <div
                                class="mr-3 flex h-12 w-12 items-center justify-center rounded-full bg-green-100 text-green-500"
                            >
                                <ic-icon [icon]="icMail" size="24px"></ic-icon>
                            </div>
                            <div>
                                <p class="m-0 font-bold">{{ patient.email }}</p>
                                <p class="text-secondary m-0">E-Mail Address</p>
                            </div>
                        </a>
                    }
                </div>
            </div>
        }
        @if (patient) {
            <div class="mt-4 w-full">
                <button
                    mat-raised-button
                    class="bg-minsk-500 mr-4 bg-purple-500 text-white"
                    (click)="openPatientNotes()"
                >
                    View Patient Notes
                </button>
                <button
                    mat-raised-button
                    class="bg-green-500 font-bold text-white hover:bg-green-700"
                    (click)="addPatientNote(patient.id)"
                >
                    Add Note
                </button>
            </div>
        }

        <!-- FLASH NOTES -->
        @if (patient) {
            <div class="mt-4 flex w-full flex-col">
                <div class="flex flex-col rounded border bg-red-100 p-4 shadow dark:bg-gray-700">
                    <div class="flex w-full justify-center text-center font-bold uppercase text-red-500">
                        FLASH NOTE
                    </div>
                    <div class="mt-4">{{ patient.flashMessage }}</div>
                </div>
            </div>
        }

        <!-- IMPORTANT DATES -->
        @if (patient) {
            <div class="mt-4 flex w-full flex-col">
                <div class="flex flex-col rounded border bg-white p-4 shadow dark:bg-gray-700">
                    <div class="flex w-full justify-center text-center font-bold uppercase text-red-500">
                        IMPORTANT DATES
                    </div>
                    <!-- Next DOS -->
                    <div class="flexbox mt-4">
                        <div class="col1">
                            <span class="text-black dark:text-white">NEXT DOS</span>
                        </div>
                        <div class="col2">
                            <span class="text-black dark:text-white">{{ (datesEtc$ | async)?.dos | dateformat }}</span>
                        </div>
                        <div class="col3">
                            <span class="text-black dark:text-white"></span>
                        </div>
                    </div>
                    <!-- SWO EXPIRE -->
                    <div class="flexbox" [ngClass]="isExpiring((datesEtc$ | async)?.cmn) ? 'danger' : ''">
                        <div class="col1">
                            <span class="text-black dark:text-white">SWO EXPIRE</span>
                        </div>
                        <div class="col2">
                            <span class="text-black dark:text-white">{{ (datesEtc$ | async)?.cmn | dateformat }}</span>
                        </div>
                        <div class="col3">
                            @if (isExpiring((datesEtc$ | async)?.cmn)) {
                                <ic-icon [icon]="icMoreVert" size="24px" (click)="SendRequestSWO(patient)"></ic-icon>
                            }
                        </div>
                    </div>
                    <!-- NOTES EXPIRE -->
                    <div class="flexbox" [ngClass]="isExpiring((datesEtc$ | async)?.notesExpireDate) ? 'danger' : ''">
                        <div class="col1">
                            <span class="text-black dark:text-white">NOTES EXPIRE</span>
                        </div>
                        <div class="col2">
                            <span class="text-black dark:text-white">{{
                                (datesEtc$ | async)?.notesExpireDate | dateformat
                            }}</span>
                        </div>
                        <div class="col3">
                            @if (isExpiring((datesEtc$ | async)?.notesExpireDate)) {
                                <ic-icon
                                    [icon]="icMoreVert"
                                    size="24px"
                                    (click)="SendRequestVisitNotes(patient)"
                                ></ic-icon>
                            }
                        </div>
                    </div>
                    <!-- PA EXPIRE -->
                    <div class="flexbox" [ngClass]="isExpiring((datesEtc$ | async)?.authDate) ? 'danger' : ''">
                        <div class="col1">
                            <span class="text-black dark:text-white">PA</span>
                        </div>
                        <div class="col2">
                            <span class="text-black dark:text-white">{{
                                (datesEtc$ | async)?.authDate | dateformat
                            }}</span>
                        </div>
                        <div class="col3"></div>
                    </div>
                </div>
            </div>
        }

        <!-- DOCTOR -->
        <div class="mt-4 flex w-full flex-col" *ngrxLet="doctor$; let doc">
            <div class="flex flex-col rounded border bg-white p-4 shadow dark:bg-gray-700">
                <div class="flex w-full justify-center text-center font-bold uppercase text-primary">DOCTOR</div>
                <mat-list>
                    @if (patient) {
                        <div class="flex flex-col">
                            <div class="flex flex-col">
                                <span class="font-bold">{{ doc.firstName }} {{ doc.lastName }}</span>
                                <span>{{ doc.address }}</span>
                                @if (doc.address2) {
                                    <span>{{ doc.address2 }}</span>
                                }
                                <span>{{ doc.city }} {{ doc.state }} {{ doc.zip }}</span>
                            </div>
                            <div class="flex flex-col">
                                <!-- Doctor Phone -->
                                @if (doc.phone) {
                                    <a
                                        href="tel:{{ doc.phone }}"
                                        class="relative flex items-center rounded-full px-2 py-3 transition duration-200 ease-in-out hover:bg-blue-100 dark:hover:bg-gray-600"
                                        matRipple
                                    >
                                        <div
                                            class="mr-3 flex h-12 w-12 items-center justify-center rounded-full bg-blue-100 text-blue-500"
                                        >
                                            <ic-icon [icon]="icPhone" size="24px"></ic-icon>
                                        </div>
                                        <div>
                                            <p class="m-0 font-bold">{{ doc.phone | phonenumber }}</p>
                                            <p class="text-secondary m-0">Phone</p>
                                        </div>
                                    </a>
                                }
                                <!-- Doctor Fax -->
                                @if (doc.fax) {
                                    <a
                                        class="relative flex items-center rounded-full px-2 py-3 transition duration-200 ease-in-out hover:bg-green-100 dark:hover:bg-gray-600"
                                        matRipple
                                        href="mailto:{{ patient.email }}"
                                    >
                                        <div
                                            class="mr-3 flex h-12 w-12 items-center justify-center rounded-full bg-green-100 text-green-500"
                                        >
                                            <ic-icon [icon]="icMail" size="24px"></ic-icon>
                                        </div>
                                        <div>
                                            <p class="m-0 font-bold">{{ doc.fax | phonenumber }}</p>
                                            <p class="text-secondary m-0">Fax</p>
                                        </div>
                                    </a>
                                }
                            </div>
                        </div>
                    }
                </mat-list>
            </div>
        </div>

        <!-- PATIENT RESPONSIBILITY -->
        @if (patient) {
            <div class="mt-4 flex w-full flex-col">
                <div class="flex flex-col rounded border bg-white p-4 shadow dark:bg-gray-700">
                    <div class="flex w-full justify-center text-center font-bold uppercase text-primary">
                        PATIENT RESPONSIBILITY
                    </div>
                    <div class="mt-4 flex w-full justify-between">
                        <span>Deductible Balance</span
                        ><span class="text-primary">{{ patient.deductible | currency }}</span>
                    </div>
                    <div class="flex w-full justify-between">
                        <span>Balance Owned</span><span class="text-primary">{{ patient.balance | currency }}</span>
                    </div>
                    <div class="mt-4 flex w-full">
                        <a
                            mat-raised-button
                            href="https://acentus365.com/payment"
                            target="_blank"
                            class="relative flex w-full justify-center bg-green-500 px-2 text-white"
                            matRipple
                        >
                            <div>
                                <p class="m-0 w-full">Process Payment</p>
                            </div>
                        </a>
                    </div>
                </div>
            </div>
        }

        <!-- INSURANCE -->
        @if (patient) {
            <div class="mt-4 flex w-full flex-col">
                <div class="flex flex-col rounded border bg-white p-4 shadow dark:bg-gray-700">
                    <div class="flex w-full justify-center text-center font-bold uppercase text-primary">INSURANCE</div>
                    <mat-list>
                        @for (insurance of insurance$ | async; track insurance) {
                            <mat-list-item>{{ insurance.name }}</mat-list-item>
                        }
                    </mat-list>
                    <button mat-raised-button color="medablue" class="w-full bg-green-500 text-white">
                        Insurance Verification
                    </button>
                </div>
            </div>
        }

        <!-- ANSWERS REORDER PORTAL -->
        @if (patient) {
            <div class="mt-4 flex w-full flex-col">
                <div class="flex flex-col rounded border bg-white p-4 shadow dark:bg-gray-700">
                    <div class="flex w-full justify-center text-center font-bold uppercase text-primary">
                        ANSWERS REORDER PORTAL
                    </div>
                    <div class="mt-4 flex w-full">
                        <button mat-raised-button color="medablue" class="w-full bg-green-500 text-white">
                            Send Invite
                        </button>
                    </div>
                </div>
            </div>
        }
    </div>
</div>
